(function($){$.fn.calendar=function(A){var B=$.extend({'months':2,'weeks':5,'format':'DD.MM.YYYY','offset':0,'weekdayOffset':1,'position':'top','language':'de','mode':'single','containerSelector':'.calendar','daySelector':'.day','nextSelector':'.btn-month-next','prevSelector':'.btn-month-prev','appendTo':'body','onChange':function(a){}},A);moment.lang(B.language);var C=moment();var D=[];return this.each(function(){var u=$(this);var v=moment(u.val(),B.format);var x=u.data('template');if(!D[x]){D[x]=doT.template($(u.data('template')).text())}var y=_data(0);var z=$(D[x](y));z.on('mousedown',function(){return false});z.on('click',B.daySelector,function(){var a=$(this).data('day');var b=$(this).data('month');var c=$(this).data('year');var d=moment(new Date(c,b,a));u.val(d.format(B.format));z.hide();var e=u.next(':input');e.focus();B.onChange(d);return false});z.on('click',B.prevSelector,function(){y=_data(--B.offset);var a=$(D[x](y));z.html(a.html());return false});z.on('click',B.nextSelector,function(){y=_data(++B.offset);var a=$(D[x](y));z.html(a.html());return false});u.on('keypress',function(e){if((e.keyCode>47&&e.keyCode<58)||e.keyCode==46){return true}return false});u.on('focus',function(){switch(B.position){case'top':default:z.css({'left':u.offset().left,'top':u.offset().top-z.height()});break}z.show()});u.on('blur',function(){z.hide()});function _data(a){var b=[moment.weekdaysMin[(B.weekdayOffset)%7],moment.weekdaysMin[(B.weekdayOffset+1)%7],moment.weekdaysMin[(B.weekdayOffset+2)%7],moment.weekdaysMin[(B.weekdayOffset+3)%7],moment.weekdaysMin[(B.weekdayOffset+4)%7],moment.weekdaysMin[(B.weekdayOffset+5)%7],moment.weekdaysMin[(B.weekdayOffset+6)%7]];var c={'days':[],'weekdays':b};var d=(a==0);var e=0;for(var m=a;m<B.months+a;m++){var f=v.clone().add('months',m);var g=v.clone().add('months',m-1);var h=v.clone().add('months',m+1);var j=f.daysInMonth();var k=g.daysInMonth();var l=f.clone().startOf('month').day();var n=l>=B.weekdayOffset?B.weekdayOffset:B.weekdayOffset-7;var o=f.clone().startOf('month').day(n).date();var p=B.weeks;var q=o>1;var r=o===1;var s=false;c.days[e]={'month':f.month(),'name':moment.months[f.month()],'year':f.year(),'prev':{'month':g.month(),'name':moment.months[g.month()],'year':g.year()},'next':{'month':h.month(),'name':moment.months[h.month()],'year':h.year()},'items':[]};for(var w=0;w<=p;w++){c.days[e]['items'][w]=[];for(var i=0;i<=6;i++){var t=(i+B.weekdayOffset)>6?(i+B.weekdayOffset)%7:(i+B.weekdayOffset);if(r){c.days[e]['items'][w][i]={'day':o,'weekday':t,'month':c.days[e].month,'year':c.days[e].year};if(o==C.date()&&c.days[e].month==C.month()&&c.days[e].year==C.year()){c.days[e]['items'][w][i].today=true}if(o==j){r=false;s=true;o=1}else{o=o<j?++o:1}continue}if(q){c.days[e]['items'][w][i]={'prev':true,'day':o,'weekday':t,'month':c.days[e].prev.month,'year':c.days[e].prev.year};if(o==C.date()&&c.days[e].prev.month==C.month()&&c.days[e].prev.year==C.year()){c.days[e]['items'][w][i].today=true}if(o==k){o=1;q=false;r=true}else{o++}continue}if(s){c.days[e]['items'][w][i]={'next':true,'day':o,'weekday':t,'month':c.days[e].next.month,'year':c.days[e].next.year};if(o==C.date()&&c.days[e].next.month==C.month()&&c.days[e].next.year==C.year()){c.days[e]['items'][w][i].today=true}o++;continue}}}d=false;e++}return c}return $(B.appendTo).append(z)})}})(jQuery);