(function(e){e.fn.calendar=function(t){var n=e.extend({months:2,weeks:5,containerSelector:".calendar",daySelector:".day",nextSelector:".btn-month-next",prevSelector:".btn-month-prev",format:"DD.MM.YYYY",appendTo:"body",offset:0,weekdayOffset:1,position:"top",language:"de",changed:function(e){}},t);moment.lang(n.language);var r=moment();var i=[];return this.each(function(){function f(e){var t=[moment.weekdaysMin[n.weekdayOffset%7],moment.weekdaysMin[(n.weekdayOffset+1)%7],moment.weekdaysMin[(n.weekdayOffset+2)%7],moment.weekdaysMin[(n.weekdayOffset+3)%7],moment.weekdaysMin[(n.weekdayOffset+4)%7],moment.weekdaysMin[(n.weekdayOffset+5)%7],moment.weekdaysMin[(n.weekdayOffset+6)%7]];var i={days:[],weekdays:t};var o=e==0;var u=0;for(var a=e;a<n.months+e;a++){var f=s.clone().add("months",a);var l=s.clone().add("months",a-1);var c=s.clone().add("months",a+1);var h=f.daysInMonth();var p=l.daysInMonth();var d=f.clone().startOf("month").day();var v=d>=n.weekdayOffset?n.weekdayOffset:n.weekdayOffset-7;var m=f.clone().startOf("month").day(v).date();var g=n.weeks;var y=m>1;var b=m===1;var w=false;i.days[u]={month:f.month(),name:moment.months[f.month()],year:f.year(),prev:{month:l.month(),name:moment.months[l.month()],year:l.year()},next:{month:c.month(),name:moment.months[c.month()],year:c.year()},items:[]};for(var E=0;E<=g;E++){i.days[u]["items"][E]=[];for(var S=0;S<=6;S++){var x=S+n.weekdayOffset>6?(S+n.weekdayOffset)%7:S+n.weekdayOffset;if(b){i.days[u]["items"][E][S]={day:m,weekday:x,month:i.days[u].month,year:i.days[u].year};if(m==r.date()&&i.days[u].month==r.month()&&i.days[u].year==r.year()){i.days[u]["items"][E][S].today=true}if(m==h){b=false;w=true;m=1}else{m=m<h?++m:1}continue}if(y){i.days[u]["items"][E][S]={prev:true,day:m,weekday:x,month:i.days[u].prev.month,year:i.days[u].prev.year};if(m==r.date()&&i.days[u].prev.month==r.month()&&i.days[u].prev.year==r.year()){i.days[u]["items"][E][S].today=true}if(m==p){m=1;y=false;b=true}else{m++}continue}if(w){i.days[u]["items"][E][S]={next:true,day:m,weekday:x,month:i.days[u].next.month,year:i.days[u].next.year};if(m==r.date()&&i.days[u].next.month==r.month()&&i.days[u].next.year==r.year()){i.days[u]["items"][E][S].today=true}m++;continue}}}o=false;u++}return i}var t=e(this);var s=moment(t.val(),n.format);var o=t.data("template");if(!i[o]){i[o]=doT.template(e(t.data("template")).text())}var u=f(0);var a=e(i[o](u));a.on("mousedown",function(){return false});a.on("click",n.daySelector,function(){var r=e(this).data("day");var i=e(this).data("month");var s=e(this).data("year");var o=moment(new Date(s,i,r));t.val(o.format(n.format));a.hide();return false});a.on("click",n.prevSelector,function(){u=f(--n.offset);var t=e(i[o](u));a.html(t.html());return false});a.on("click",n.nextSelector,function(){u=f(++n.offset);var t=e(i[o](u));a.html(t.html());return false});t.on("keypress",function(e){if(e.keyCode>47&&e.keyCode<58||e.keyCode==46){return true}return false});t.on("focus",function(){switch(n.position){case"top":default:a.css({left:t.offset().left,top:t.offset().top-a.height()});break}a.show()});t.on("blur",function(){a.hide()});return e(n.appendTo).append(a)})}})(jQuery);